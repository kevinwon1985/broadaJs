/**
 Ember-REST.js 0.1.1

 Copyright (c) 2012 Cerebris Corporation

 Licensed under the MIT license:
   http://www.opensource.org/licenses/mit-license.php
*/
if(Ember.ResourceAdapter===undefined){Ember.ResourceAdapter=Ember.Mixin.create({_resourceRequest:function(a){a.url=this._resourceUrl();a.dataType="json";if(this._prepareResourceRequest!==undefined){this._prepareResourceRequest(a)}return jQuery.ajax(a)}})}Ember.Resource=Ember.Object.extend(Ember.ResourceAdapter,Ember.Copyable,{resourceIdField:"id",resourceUrl:Ember.required(),duplicateProperties:function(c,b){var d;if(b===undefined){b=this.resourceProperties}for(var a=0;a<b.length;a++){d=b[a];this.set(d,c.get(d))}},copy:function(a){var b=this.constructor.create();b.duplicateProperties(this);b.set(this.resourceIdField,this.get(this.resourceIdField));return b},serialize:function(){var b=this.resourceName,d=this.resourceProperties,e,a={};a[b]={};for(var c=0;c<d.length;c++){e=d[c];a[b][e]=this.serializeProperty(e)}return a},serializeProperty:function(a){return this.get(a)},deserialize:function(a){Ember.beginPropertyChanges(this);for(var b in a){if(a.hasOwnProperty(b)){this.deserializeProperty(b,a[b])}}Ember.endPropertyChanges(this);return this},deserializeProperty:function(b,a){this.set(b,a)},findResource:function(){var a=this;return this._resourceRequest({type:"GET"}).done(function(b){a.deserialize(b)})},saveResource:function(){var a=this;if(this.validate!==undefined){var b=this.validate();if(b){return{fail:function(c){c(b);return this},done:function(){return this},always:function(c){c();return this}}}}return this._resourceRequest({type:this.isNew()?"POST":"PUT",data:this.serialize()}).done(function(c){if(c){a.deserialize(c)}})},destroyResource:function(){return this._resourceRequest({type:"DELETE"})},isNew:function(){return Ember.empty(this._resourceId())},_resourceUrl:function(){var a=this.resourceUrl,b=this._resourceId();if(!Ember.empty(b)){a+="/"+b}return a},_resourceId:function(){return this.get(this.resourceIdField)}});Ember.ResourceController=Ember.ArrayController.extend(Ember.ResourceAdapter,{resourceType:Ember.required(),init:function(){this._super();this.clearAll()},load:function(a){var b=this.get("resourceType").create().deserialize(a);this.pushObject(b)},loadAll:function(b){for(var a=0;a<b.length;a++){this.load(b[a])}},clearAll:function(){this.set("content",[])},findAll:function(){var a=this;return this._resourceRequest({type:"GET"}).done(function(b){a.clearAll();a.loadAll(b)})},_resourceUrl:function(){if(this.resourceUrl===undefined){var b=this.get("resourceType");if(b.prototype.resourceUrl===undefined){for(var c=b.PrototypeMixin.mixins.length-1;c>=0;c--){var a=b.PrototypeMixin.mixins[c];if(a.properties!==undefined&&a.properties.resourceUrl!==undefined){return a.properties.resourceUrl}}}else{return b.prototype.resourceUrl}}return this.resourceUrl}});